@{
    ViewBag.Title = "Index";
}

<style>
    .iconwidth {
        width: 16px;
        height: 16px;
        margin: 1px;
        display: inline-block;
    }
</style>

<script type="text/javascript">

    var webSiteform = new Ext.form.FormPanel({
        frame: true,
        hidden: true,
        autoScroll:true,
        layout: 'form',
        anchor: "100% 100%",
        reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' },
        [
            'ID', 'SiteTitle', 'CompanyName', 'CompanyAddress', 'CompanyType', 'CompanyAddress', 'Telephone', 'Email', 'HostAddress', 'IndexPage', 'PageContent'
        ]),
        items: [
          {
              layout: 'column',
              items: [{
                  columnWidth: .5,
                  layout: 'form',
                  items: [
                      {
                          xtype: "hidden",
                          name: "ID",
                          id: 'websiteId'
                      },
                      {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站标题',
                          name: 'SiteTitle',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站名称',
                          name: 'CompanyName',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站地址',
                          name: 'CompanyAddress',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '电话号码',
                          name: 'Telephone',
                          labelWidth: 50,
                      }
                  ]
              }, {
                  columnWidth: .5,
                  layout: 'form',
                  items: [
                      {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站分类',
                          name: 'CompanyType',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: 'Email',
                          name: 'Email',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站域名',
                          name: 'HostAddress',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          name: 'IndexPage',
                          fieldLabel: '网站主页',
                          labelWidth: 50,
                      }
                  ]
              }
              ]
          },
          { xtype: 'Starthtmleditor', hideLabel: true, name: 'PageContent', labelWidth: 50, anchor: "100% 100%", }
        ], buttons: [{
            text: '保存',
            handler: function () {
                var websiteId = Ext.getCmp("websiteId").value;
                var type = websiteId ? "Put" : "Post";
                if (webSiteform.getForm().isValid()) {
                    webSiteform.getForm().submit({
                        url: '/Api/Cms/WebSite/' + websiteId,
                        method: type,
                        params: {
                        },
                        waitTitle: '请等待',
                        waitMsg: '正在提交中',
                        success: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                           // Ext.getCmp("webSiteTree").root.reload()
                        },
                        failure: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                        }
                    });
                }
            }
        }]
    });

    var channelForm=  new Ext.form.FormPanel({
        frame: true,
        autoScroll: true,
        hidden: true,
        layout: 'form',
        anchor: "100% 100%",
        reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' },
        [
            'ID', 'ChannelName', 'ChannelCode', 'ChannelRemark', 'WebSiteID', 'PageContent', "SortIndex"
        ]),
        items: [
           {
               layout: 'column',
               items: [{
                   columnWidth: .33,
                   layout: 'form',
                   items: [
                       { xtype: "hidden", name: "ID", id: 'channelId' },
                       { xtype: 'textfield', readOnly: false, fieldLabel: '频道名称', name: 'ChannelName', labelWidth: 50 },
                       { xtype: 'textfield', readOnly: false, fieldLabel: '频道编号', name: 'ChannelCode', labelWidth: 50 },

                   ]
               },
               {
                   columnWidth: .33,
                   layout: 'form',
                   items: [
                       { xtype: 'textfield', readOnly: false, fieldLabel: '频道备注', name: 'ChannelRemark', labelWidth: 50 },
                       {
                           fieldLabel: '归属网站', name: 'WebSiteID', hiddenName: 'WebSiteID', xtype: 'combo', mode: 'remote',
                           width: "200",
                           displayField: "Name", valueField: "Id", editable: false, typeAhead: true, forceSelection: true, triggerAction: 'all',
                           store: new Ext.data.JsonStore({
                               autoLoad: true,
                               method: 'Post',
                               idProperty: 'ID',
                               url: "/Api/Cms/WebSite/GetWebSiteCombox/",
                               fields: [{
                                   name: 'Name',
                                   mapping: 'CompanyName'
                               }, {
                                   name: 'Id',
                                   mapping: 'ID'
                               }]
                           }),
                       }]
               }, {
                   columnWidth: .33,
                   layout: 'form',
                   items: [
                     { xtype: 'textfield', readOnly: false, fieldLabel: '排序', name: 'SortIndex', labelWidth: 50 }
                   ]
               }]
           }

           , { xtype: 'Starthtmleditor', hideLabel: true, name: 'PageContent', labelWidth: 50, anchor: "100% 100%" }
        ], buttons: [{
            text: '保存',
            handler: function () {
                //{ xtype: "hidden", name: "ID", id: 'channelId' },
                var channelId = Ext.getCmp("channelId").value;
                var type = channelId ? "Put" : "Post";
                if (channelForm.getForm().isValid()) {
                    channelForm.getForm().submit({
                        url: '/Api/Cms/CmsChannel/' + channelId,
                        method: type,
                        params: {
                        },
                        waitTitle: '请等待',
                        waitMsg: '正在提交中',
                        success: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                            // Ext.getCmp("webSiteTree").root.reload()
                        },
                        failure: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                        }
                    });
                }
            }
        }]
    });

    var classifyForm = new Ext.form.FormPanel({
        frame: true,
        autoScroll: true,
        hidden: true,
        layout: 'form',
        anchor: "100% 100%",
        reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' }, [
            'ID', 'Name', 'Code', 'Remark', 'ChannelID', 'PageContent', "SortIndex"
        ]),
        items: [
            {
                layout: 'column',
                items: [{
                    columnWidth: .33,
                    layout: 'form',
                    items: [
                        { xtype: "hidden", name: "ID", id: 'classifyId' },
                        { xtype: 'textfield', readOnly: false, fieldLabel: '分类名称', name: 'Name', labelWidth: 50 },
                        { xtype: 'textfield', readOnly: false, fieldLabel: '分类编号', name: 'Code', labelWidth: 50 }
                    ]
                }, {
                    columnWidth: .33,
                    layout: 'form',
                    items: [
                        { xtype: 'textfield', readOnly: false, fieldLabel: '备注', name: 'Remark', labelWidth: 50 },
                        {
                            fieldLabel: '归属频道',
                            name: 'ChannelID',
                            hiddenName: 'ChannelID',
                            xtype: 'combo',
                            //本地数据源  local/remote
                            mode: 'remote',
                            //设置为选项的text的字段
                            displayField: "Name",
                            //设置为选项的value的字段 
                            valueField: "Id",
                            //是否可以输入，还是只能选择下拉框中的选项
                            editable: false,
                            typeAhead: true,
                            //必须选择一项
                            forceSelection: true,
                            //输入部分选项内容匹配的时候显示所有的选项
                            triggerAction: 'all',
                            width:"200",
                            //数据
                            store: new Ext.data.JsonStore({
                                autoLoad: true,
                                method: 'Post',
                                idProperty: 'ID',
                                url: "/Api/Cms/CmsChannel/GetChannelCombox/",
                                fields: [{
                                    name: 'Name',
                                    mapping: 'ChannelName'
                                }, {
                                    name: 'Id',
                                    mapping: 'ID'
                                }]
                            })
                        }

                    ]
                }, {
                    columnWidth: .33,
                    layout: 'form',
                    items: [{ xtype: 'textfield', readOnly: false, fieldLabel: '排序', name: 'SortIndex', labelWidth: 50 }]
                }]
            }
             , { xtype: 'Starthtmleditor', hideLabel: true, name: 'PageContent', labelWidth: 50, anchor: "100% 100%" }
        ], buttons: [{
            text: '保存',
            handler: function () {
                //{ xtype: "hidden", name: "ID", id: 'classifyId' },
                var classifyId = Ext.getCmp("classifyId").value;
                var type = classifyId ? "Put" : "Post";
                if (classifyForm.getForm().isValid()) {
                    classifyForm.getForm().submit({
                        url: '/Api/Cms/CmsClassify/' + classifyId,
                        method: type,
                        params: {
                        },
                        waitTitle: '请等待',
                        waitMsg: '正在提交中',
                        success: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                        },
                        failure: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                        }
                    });
                }
            }
        }]
    });

    var pageTypefrom= new Ext.form.FormPanel({
        frame: true,
        hidden: true,
        autoScroll: true,
        layout: 'form',
        anchor: "100% 100%",
        reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' },
        [
            'ID','ClassifyID','Remark','hasTitle','hasArticle','hasPictrue','hasForm'
        ]),
        items: [
                        { xtype: "hidden", name: "ID", id: 'pageTypeId' },
                        { xtype: 'hidden', readOnly: false, fieldLabel: 'ClassifyID', name: 'ClassifyID', labelWidth: 50 },
                        { xtype: 'textfield', readOnly: false, fieldLabel: '备注信息', name: 'Remark', labelWidth: 50 },
                        {
                            fieldLabel: '是否有标题', name: 'hasTitle', hiddenName: 'hasTitle', xtype: 'combo', mode: 'local', displayField: "Name",
                            valueField: "Id", editable: false, typeAhead: true, emptyText: '请选择...', forceSelection: true,
                            triggerAction: 'all',displayField: "Name",valueField: "Id",
                            store: new Ext.data.JsonStore({
                                autoLoad: true,
                                method: 'Post',
                                idProperty: 'ID',
                                url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                fields: [{
                                    name: 'Name',
                                    mapping: 'Title'
                                }, {
                                    name: 'Id',
                                    mapping: 'Value'
                                }]
                            }),
                            width: 300
                        }, {
                            fieldLabel: '是否有文章', name: 'hasArticle', hiddenName: 'hasArticle', xtype: 'combo', mode: 'local', displayField: "Name",
                            valueField: "Id", editable: false, typeAhead: true, emptyText: '请选择...', forceSelection: true,
                            triggerAction: 'all', displayField: "Name", valueField: "Id",
                            store: new Ext.data.JsonStore({
                                autoLoad: true,
                                method: 'Post',
                                idProperty: 'ID',
                                url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                fields: [{
                                    name: 'Name',
                                    mapping: 'Title'
                                }, {
                                    name: 'Id',
                                    mapping: 'Value'
                                }]

                            }),
                            width: 300
                        },
                        {
                            fieldLabel: '是否有图片', name: 'hasPictrue', hiddenName: 'hasPictrue', xtype: 'combo', mode: 'local', displayField: "Name",
                            valueField: "Id", editable: false, typeAhead: true, emptyText: '请选择...', forceSelection: true,
                            triggerAction: 'all', displayField: "Name", valueField: "Id",
                            store: new Ext.data.JsonStore({
                                autoLoad: true,
                                method: 'Post',
                                idProperty: 'ID',
                                url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                fields: [{
                                    name: 'Name',
                                    mapping: 'Title'
                                }, {
                                    name: 'Id',
                                    mapping: 'Value'
                                }]
                            }),
                            width: 300
                        }, {
                            fieldLabel: '是否有表单', name: 'hasForm', hiddenName: 'hasForm', xtype: 'combo', mode: 'local', displayField: "Name",
                            valueField: "Id", editable: false, typeAhead: true, emptyText: '请选择...', forceSelection: true,
                            triggerAction: 'all', displayField: "Name", valueField: "Id",
                            store: new Ext.data.JsonStore({
                                autoLoad: true,
                                method: 'Post',
                                idProperty: 'ID',
                                url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                fields: [{
                                    name: 'Name',
                                    mapping: 'Title'
                                }, {
                                    name: 'Id',
                                    mapping: 'Value'
                                }]
                            }),
                            width: 300
                        },
        ], buttons: [{
            text: '保存',
            handler: function () {
                //{ xtype: "hidden", name: "ID", id: 'classifyId' },
                var pageTypeId = Ext.getCmp("pageTypeId").value;
                var type = pageTypeId ? "Put" : "Post";
                if (pageTypefrom.getForm().isValid()) {
                    pageTypefrom.getForm().submit({
                        url: '/Api/Cms/CmsPageType/' + pageTypeId,
                        method: type,
                        params: {
                        },
                        waitTitle: '请等待',
                        waitMsg: '正在提交中',
                        success: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                        },
                        failure: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                        }
                    });
                }
            }
        }]
    });


    function RefreshPanel(formpanel,panel)
    {
        webSiteform.hide();
        channelForm.hide();
        classifyForm.hide();
        pageTypefrom.hide();
        formpanel.show();
        panel.doLayout();
    }


    Ext.onReady(function () {
        Ext.QuickTips.init();
        new Ext.Viewport({
            title: "Viewport",
            layout: "border",
            defaults: {
                bodyStyle: "background-color: #FFFFFF;",
            },
            items: [
                        {
                            region: 'west',
                            title: '网站信息',
                            xtype: 'treepanel',
                            id: "webSiteTree",
                            width: 200,
                            autoScroll: true,
                            loader: new Ext.tree.TreeLoader({
                                url: '/Api/Cms/CmsPageType/GetWebSiteTree'
                            }),
                            root: new Ext.tree.AsyncTreeNode({
                                expanded: true,
                            }),
                            rootVisible: false,
                            listeners: {
                                click: function (node) {
                                    var pannel = Ext.getCmp("panel1");

                                    switch (node.attributes.attributes.type) {
                                        case "WebSite":
                                            webSiteform.form.load({
                                                url: '@Url.Content("/Api/Cms/WebSite/GetForm/")' + node.id,
                                                 method: "Get",
                                                 waitMsg: 'Loading',
                                                 success: function (form, response) {
                                                     RefreshPanel(webSiteform, pannel)
                                                 }
                                             });
                                            break;
                                        case "CmsChannel":
                                            channelForm.form.load({
                                                url: '@Url.Content("/Api/Cms/CmsChannel/GetForm/")' + node.id,
                                                method: "Get",
                                                waitMsg: 'Loading',
                                                success: function (form, response) {
                                                    RefreshPanel(channelForm, pannel)
                                                }
                                            });
                                            break;
                                        case "CmsClassify":
                                            classifyForm.form.load({
                                                url: '@Url.Content("/Api/Cms/CmsClassify/GetForm/")' + node.id,
                                                  method: "Get",
                                                  waitMsg: 'Loading',
                                                  success: function (form, response) {
                                                      RefreshPanel(classifyForm, pannel)
                                                  }
                                              });
                                            break;
                                        case "CmsPageType":
                                            pageTypefrom.form.load({
                                                url: '@Url.Content("/Api/Cms/CmsPageType/GetForm/")' + node.id,
                                                 method: "Get",
                                                 waitMsg: 'Loading',
                                                 success: function (form, response) {
                                                     RefreshPanel(pageTypefrom, pannel)
                                                 }
                                             });
                                            break;
                                    }

                                }
                            }
                        },
                        {
                            region: "center",
                            id: "panel1",
                            split: true,
                            border: false,
                            collapsible: false,
                            xtype: "panel",
                            layout: "anchor",
                            autoScroll: true,
                            items: [channelForm, webSiteform, classifyForm, pageTypefrom]

                        }

            ]
        });

    });

</script>
@* var pid;

    
    var addform = new Ext.FormPanel({
        buttonAlign: 'center',
        labelAlign: "right",
        plain: true,
        anchor: '100% 100%',
        layout: "anchor",
        frame: true,
        reader: new Ext.data.JsonReader(
            { successProperty: 'success', root: 'message' },
            ['ID', 'PDictionaryID', 'Code', 'Title', 'Value', 'Sort', 'iconCls', 'Desc']
         ),
        defaults: { margins: '0 5 0 0' },
        title: "字典信息",
        items: [
            {
                xtype: 'fieldset',
                collapsible: false,
                anchor: '100% 100%',
                items: [{
                    xtype: "hidden",
                    name: "PDictionaryID",
                    id: "pid"
                },
                {
                    xtype: "hidden",
                    name: "ID",
                    id:'id'
                }, {
                    xtype: "textfield",
                    name: "Code",
                    fieldLabel: '字典代码',
                },
                    {
                        fieldLabel: '字典键',
                        name: 'Title',
                        xtype: 'textfield',
                        width: 300
                    }, {
                        fieldLabel: '字典值',
                        name: 'Value',
                        xtype: 'textfield',
                        width: 300
                    }, {
                        fieldLabel: '字典排序',
                        name: 'Sort',
                        xtype: 'textfield',
                        width: 300
                    },
                    {
                        fieldLabel: '备注',
                        xtype: 'textarea',
                        name: "Desc",
                        height: 150,
                        anchor: '95%'
                    }
                ]
            }
        ], buttons: [{
            xtype: "button",
            text: "新增子项",
            id: 'subadd',
            style: "float:right",
            handler: function () {
                addform.form.reset();
            }
        }, {
            xtype: "button",
            text: "保存",
            id:"update",
            style: "float:right",
            handler: function () {
                var pid = Ext.getCmp("id").getValue();
                var type = pid ? "Put" : "Post";
                addform.getForm().submit({
                    url: '/Api/Dictionary/' + pid,
                    method: type,
                    waitTitle: '请等待',
                    waitMsg: '正在提交中',
                    success: function (form, action) {
                        Ext.getCmp("dictree").root.reload()
                        Ext.Msg.alert('提示', action.result.message);
                    },
                    failure: function (form, action) {
                        Ext.Msg.alert('提示', action.result.message);
                    }
                });
            }
        }, {
            xtype: "button",
            text: "返回",
            id: "return",
            hidden: true,
            style: "float:right",
            handler: function () {
                addform.form.reset()
                Ext.getCmp("update").show();
                Ext.getCmp("subadd").show();
                Ext.getCmp("return").hide();
                Ext.getCmp("reset").hide();
                addform.form.load({
                    url: '@Url.Content("/Api//Dictionary/GetForm/")' + pid,
                    method: "Get",
                    waitMsg: 'Loading',
                    success: function (form, action) {
                      //  ;
                    }
                });
            }
        }, {
            xtype: "button",
            text: "删除",
            id: "delete",
            style: "float:right",
            handler: function () {
                addform.form.submit({
                    url: '@Url.Content("/Api/Dictionary/")' + Ext.getCmp("id").getValue(),
                     method: "Delete",
                     waitMsg: 'Loading',
                     success: function (form, action) {
                         Ext.getCmp("dictree").root.reload()
                         addform.form.reset();
                         Ext.Msg.alert('提示', action.result.message);
                     }
                });
            }
        }, {
            xtype: "button",
            text: "重置",
            id: "reset",
            hidden: true,
            style: "float:right",
            handler: function () {
                addform.form.reset();
                Ext.getCmp("pid").setValue(pid);
            }
        }]
    });*@