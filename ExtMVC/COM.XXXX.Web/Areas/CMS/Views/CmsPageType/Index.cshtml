@using COM.XXXX.Common
@{
    ViewBag.Title = "Index";
}

<style>
    .iconwidth {
        width: 16px;
        height: 16px;
        margin: 1px;
        display: inline-block;
    }
</style>

<script type="text/javascript">
    //#region  网站信息
    var webSiteform = new Ext.form.FormPanel({
        frame: true,
        hidden: true,
        autoScroll: true,
        layout: 'form',
        anchor: "100% 100%",
        reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' },
        [
            'ID', 'SiteTitle', 'CompanyName', 'CompanyAddress', 'CompanyType', 'CompanyAddress', 'Telephone', 'Email', 'HostAddress', 'IndexPage', 'PageContent'
        ]),
        items: [
          {
              layout: 'column',
              items: [{
                  columnWidth: .5,
                  layout: 'form',
                  items: [
                      {
                          xtype: "hidden",
                          name: "ID",
                          id: 'websiteId'
                      },
                      {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站标题',
                          name: 'SiteTitle',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站名称',
                          name: 'CompanyName',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站地址',
                          name: 'CompanyAddress',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '电话号码',
                          name: 'Telephone',
                          labelWidth: 50,
                      }
                  ]
              }, {
                  columnWidth: .5,
                  layout: 'form',
                  items: [
                      {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站分类',
                          name: 'CompanyType',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: 'Email',
                          name: 'Email',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          readOnly: false,
                          fieldLabel: '网站域名',
                          name: 'HostAddress',
                          labelWidth: 50,
                      }, {
                          xtype: 'textfield',
                          name: 'IndexPage',
                          fieldLabel: '网站主页',
                          labelWidth: 50,
                      }
                  ]
              }
              ]
          },
          { xtype: 'Starthtmleditor', hideLabel: true, name: 'PageContent', labelWidth: 50, anchor: "100% 100%", }
        ], buttons: [{
            text: '新增子频道',
            handler: function () {
                RefreshPanel(channelForm, Ext.getCmp("panel1"));
                var websitid = Ext.getCmp("websiteId").getValue();
                channelForm.getForm().reset();
                Ext.getCmp("channelpid").setValue(websitid);
            }
        }, {
            text: '保存',
            handler: function () {
                var websiteId = Ext.getCmp("websiteId").value;
                var type = websiteId ? "Put" : "Post";
                if (webSiteform.getForm().isValid()) {
                    webSiteform.getForm().submit({
                        url: '/Api/Cms/WebSite/' + websiteId,
                        method: type,
                        params: {
                        },
                        waitTitle: '请等待',
                        waitMsg: '正在提交中',
                        success: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                            // Ext.getCmp("webSiteTree").root.reload()
                        },
                        failure: function (form, action) {
                            Ext.Msg.alert('提示', action.result.message);
                        }
                    });
                }
            }
        }]
    });
    //#endregion

    //#region 频道信息
    //#endregion
    var channelForm = new Ext.form.FormPanel({
        frame: true,
        autoScroll: true,
        hidden: true,
        layout: 'form',
        anchor: "100% 100%",
        reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' }, [
            'ID', 'ChannelName', 'ChannelCode', 'ChannelRemark', 'WebSiteID', 'PageContent', "SortIndex"
        ]),
        items: [{
            layout: 'column',
            items: [{
                columnWidth: .33,
                layout: 'form',
                items: [
                    { xtype: "hidden", name: "ID", id: 'channelId' },
                    { xtype: 'textfield', readOnly: false, fieldLabel: '频道名称', name: 'ChannelName', labelWidth: 50 },
                    { xtype: 'textfield', readOnly: false, fieldLabel: '频道编号', name: 'ChannelCode', labelWidth: 50 },
                ]
            },
            {
                columnWidth: .33,
                layout: 'form',
                items: [
                    { xtype: 'textfield', readOnly: false, fieldLabel: '频道备注', name: 'ChannelRemark', labelWidth: 50 },
                    {
                        fieldLabel: '归属网站', id: "channelpid", name: 'WebSiteID', hiddenName: 'WebSiteID', xtype: 'combo', mode: 'remote',
                        width: "200",
                        displayField: "Name", valueField: "Id", editable: false, typeAhead: true, forceSelection: true, triggerAction: 'all',
                        store: new Ext.data.JsonStore({
                            autoLoad: true,
                            method: 'Post',
                            idProperty: 'ID',
                            url: "/Api/Cms/WebSite/GetWebSiteCombox/",
                            fields: [{
                                name: 'Name',
                                mapping: 'CompanyName'
                            }, {
                                name: 'Id',
                                mapping: 'ID'
                            }]
                        }),
                    }]
            }, {
                columnWidth: .33,
                layout: 'form',
                items: [
                  { xtype: 'textfield', readOnly: false, fieldLabel: '排序', name: 'SortIndex', labelWidth: 50 }
                ]
            }]
        },
            { xtype: 'Starthtmleditor', hideLabel: true, name: 'PageContent', labelWidth: 50, anchor: "100% 100%" }
        ],
        buttons: [
            {
                text: '新增子分类',
                handler: function () {
                    RefreshPanel(classifyForm, Ext.getCmp("panel1"));
                    var channelId = Ext.getCmp("channelId").getValue();
                    classifyForm.getForm().reset();
                    Ext.getCmp("classifypid").setValue(channelId);
                }
            },
            {
                text: '保存',
                handler: function () {
                    //{ xtype: "hidden", name: "ID", id: 'channelId' },
                    var channelId = Ext.getCmp("channelId").value;
                    var type = channelId ? "Put" : "Post";
                    if (channelForm.getForm().isValid()) {
                        channelForm.getForm().submit({
                            url: '/Api/Cms/CmsChannel/' + channelId,
                            method: type,
                            params: {
                            },
                            waitTitle: '请等待',
                            waitMsg: '正在提交中',
                            success: function (form, action) {
                                Ext.Msg.alert('提示', action.result.message);
                                // Ext.getCmp("webSiteTree").root.reload()
                            },
                            failure: function (form, action) {
                                Ext.Msg.alert('提示', action.result.message);
                            }
                        });
                    }
                }
            },
            {
                text: '返回',
                handler: function () {
                    var websiteid = Ext.getCmp("channelpid").value;
                    webSiteform.form.load({
                        url: '@Url.Content("/Api/Cms/WebSite/GetForm/")' + websiteid,
                        method: "Get",
                        waitMsg: 'Loading',
                        success: function (form, response) {
                            RefreshPanel(webSiteform, Ext.getCmp("panel1"));
                        }
                    });
                }
            }
        ]
    }
        );


        //分类信息
        var classifyForm = new Ext.form.FormPanel({
            frame: true,
            autoScroll: true,
            hidden: true,
            layout: 'form',
            anchor: "100% 100%",
            reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' }, [
                'ID', 'Name', 'Code', 'Remark', 'ChannelID', 'PageContent', "SortIndex"
            ]),
            items: [
                {
                    layout: 'column',
                    items: [{
                        columnWidth: .33,
                        layout: 'form',
                        items: [
                            { xtype: "hidden", name: "ID", id: 'classifyId' },
                            { xtype: 'textfield', readOnly: false, fieldLabel: '分类名称', name: 'Name', labelWidth: 50 },
                            { xtype: 'textfield', readOnly: false, fieldLabel: '分类编号', name: 'Code', labelWidth: 50 }
                        ]
                    }, {
                        columnWidth: .33,
                        layout: 'form',
                        items: [
                            { xtype: 'textfield', readOnly: false, fieldLabel: '备注', name: 'Remark', labelWidth: 50 },
                            {
                                fieldLabel: '归属频道',
                                name: 'ChannelID',
                                hiddenName: 'ChannelID',
                                id: "classifypid",
                                xtype: 'combo',
                                //本地数据源  local/remote
                                mode: 'remote',
                                //设置为选项的text的字段
                                displayField: "Name",
                                //设置为选项的value的字段 
                                valueField: "Id",
                                //是否可以输入，还是只能选择下拉框中的选项
                                editable: false,
                                typeAhead: true,
                                //必须选择一项
                                forceSelection: true,
                                //输入部分选项内容匹配的时候显示所有的选项
                                triggerAction: 'all',
                                width: "200",
                                //数据
                                store: new Ext.data.JsonStore({
                                    autoLoad: true,
                                    method: 'Post',
                                    idProperty: 'ID',
                                    url: "/Api/Cms/CmsChannel/GetChannelCombox/",
                                    fields: [{
                                        name: 'Name',
                                        mapping: 'ChannelName'
                                    }, {
                                        name: 'Id',
                                        mapping: 'ID'
                                    }]
                                })
                            }

                        ]
                    }, {
                        columnWidth: .33,
                        layout: 'form',
                        items: [{ xtype: 'textfield', readOnly: false, fieldLabel: '排序', name: 'SortIndex', labelWidth: 50 }]
                    }]
                }
                 , { xtype: 'Starthtmleditor', hideLabel: true, name: 'PageContent', labelWidth: 50, anchor: "100% 100%" }
            ], buttons: [{
                text: '增加子页面',
                handler: function () {
                    webSiteform.hide();
                    channelForm.hide();
                    classifyForm.hide();
                    pageTypefrom.show();
                    pageTypePanel.show();
                    channelForm.doLayout();
                    pageTypePanel.doLayout();

                    var classifypid = Ext.getCmp("classifyId").getValue();
                    pageTypefrom.getForm().reset();
                    Ext.getCmp("pageTypepid").setValue(classifypid);
                }
            }, {
                text: '保存',
                handler: function () {
                    //{ xtype: "hidden", name: "ID", id: 'classifyId' },
                    var classifyId = Ext.getCmp("classifyId").value;
                    var type = classifyId ? "Put" : "Post";
                    if (classifyForm.getForm().isValid()) {
                        classifyForm.getForm().submit({
                            url: '/Api/Cms/CmsClassify/' + classifyId,
                            method: type,
                            params: {
                            },
                            waitTitle: '请等待',
                            waitMsg: '正在提交中',
                            success: function (form, action) {
                                Ext.Msg.alert('提示', action.result.message);
                            },
                            failure: function (form, action) {
                                Ext.Msg.alert('提示', action.result.message);
                            }
                        });
                    }
                }
            }, {
                text: '返回',
                handler: function () {
                    var classifypid = Ext.getCmp("classifypid").value;
                    channelForm.form.load({
                        url: '@Url.Content("/Api/Cms/CmsChannel/GetForm/")' + classifypid,
                        method: "Get",
                        waitMsg: 'Loading',
                        success: function (form, response) {
                            RefreshPanel(channelForm, Ext.getCmp("panel1"))

                        }
                    });

                }
            }]
        });

            //#region页面类型
            var pageTypefrom = new Ext.form.FormPanel({
                title: "页面定制",
                frame: true,
                hidden: true,
                autoScroll: false,
                layout: 'form',
                anchor: "100%",
                labelAlign: "right",
                labelWidth: 65,
                autoHeight: true,
                reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' },
                    [
                        'ID', 'ClassifyID', 'Remark', 'hasTitle', 'hasArticle', 'hasPictrue', 'hasForm'
                    ]),
                items: [
                {
                    layout: 'column',
                    items: [
                        {
                            columnWidth: .25,
                            layout: 'form',
                            items: [
                                {
                                    fieldLabel: '标题',
                                    name: 'hasTitle',
                                    hiddenName: 'hasTitle',
                                    xtype: 'combo',
                                    mode: 'local',
                                    displayField: "Name",
                                    valueField: "Id",
                                    editable: false,
                                    typeAhead: true,
                                    emptyText: '请选择...',
                                    forceSelection: true,
                                    triggerAction: 'all',
                                    width: 100,
                                    labelWidth: 50,
                                    store: new Ext.data.JsonStore({
                                        autoLoad: true,
                                        method: 'Post',
                                        idProperty: 'ID',
                                        url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                        fields: [{
                                            name: 'Name',
                                            mapping: 'Title'
                                        }, {
                                            name: 'Id',
                                            mapping: 'Value'
                                        }]
                                    })
                                }
                            ]
                        }, {
                            columnWidth: .25,
                            layout: 'form',
                            items: [{
                                fieldLabel: '文章',
                                name: 'hasArticle',
                                hiddenName: 'hasArticle',
                                xtype: 'combo',
                                mode: 'local',
                                editable: false,
                                typeAhead: true,
                                emptyText: '请选择...',
                                forceSelection: true,
                                triggerAction: 'all',
                                displayField: "Name",
                                valueField: "Id",
                                width: 100,
                                labelWidth: 50,
                                store: new Ext.data.JsonStore({
                                    autoLoad: true,
                                    method: 'Post',
                                    idProperty: 'ID',
                                    url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                    fields: [{
                                        name: 'Name',
                                        mapping: 'Title'
                                    }, {
                                        name: 'Id',
                                        mapping: 'Value'
                                    }]
                                })
                            }]
                        }, {
                            columnWidth: .25,
                            layout: 'form',
                            items: [{
                                fieldLabel: '图片',
                                name: 'hasPictrue',
                                hiddenName: 'hasPictrue',
                                xtype: 'combo',
                                mode: 'local',
                                displayField: "Name",
                                valueField: "Id",
                                editable: false,
                                typeAhead: true,
                                emptyText: '请选择...',
                                forceSelection: true,
                                width: 100,
                                triggerAction: 'all',
                                labelWidth: 50,
                                store: new Ext.data.JsonStore({
                                    autoLoad: true,
                                    method: 'Post',
                                    idProperty: 'ID',
                                    url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                    fields: [{
                                        name: 'Name',
                                        mapping: 'Title'
                                    }, {
                                        name: 'Id',
                                        mapping: 'Value'
                                    }]
                                })
                            }]
                        }, {
                            columnWidth: .25,
                            layout: 'form',
                            items: [{
                                fieldLabel: '表单',
                                name: 'hasForm',
                                hiddenName: 'hasForm',
                                xtype: 'combo',
                                mode: 'local',
                                displayField: "Name",
                                valueField: "Id",
                                editable: false,
                                typeAhead: true,
                                emptyText: '请选择...',
                                forceSelection: true,
                                triggerAction: 'all',
                                width: 100,
                                labelWidth: 50,
                                store: new Ext.data.JsonStore({
                                    autoLoad: true,
                                    method: 'Post',
                                    idProperty: 'ID',
                                    url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                    fields: [{
                                        name: 'Name',
                                        mapping: 'Title'
                                    }, {
                                        name: 'Id',
                                        mapping: 'Value'
                                    }]
                                })
                            }]
                        }
                    ]
                }, {
                    layout: 'column',
                    items: [
                    {
                        columnWidth: .8,
                        layout: 'form',
                        items: [
                            { xtype: "hidden", name: "ID", id: 'pageTypeId' },
                            { xtype: 'hidden', id: "pageTypepid", readOnly: false, fieldLabel: 'ClassifyID', name: 'ClassifyID', labelWidth: 50 },
                            { xtype: 'textfield', readOnly: false, fieldLabel: '备注信息', name: 'Remark', labelWidth: 50, anchor: "95%" }]
                    }, {

                        columnWidth: .2,
                        layout: 'form',
                        items: [{
                            xtype: 'button',
                            text: '保存',
                            handler: function () {
                                //{ xtype: "hidden", name: "ID", id: 'classifyId' },
                                var pageTypeId = Ext.getCmp("pageTypeId").value;
                                var type = pageTypeId ? "Put" : "Post";
                                if (pageTypefrom.getForm().isValid()) {
                                    pageTypefrom.getForm().submit({
                                        url: '/Api/Cms/CmsPageType/' + pageTypeId,
                                        method: type,
                                        params: {
                                        },
                                        waitTitle: '请等待',
                                        waitMsg: '正在提交中',
                                        success: function (form, action) {
                                            Ext.Msg.alert('提示', action.result.message);
                                        },
                                        failure: function (form, action) {
                                            Ext.Msg.alert('提示', action.result.message);
                                        }
                                    });
                                }
                            }
                        }]
                    }]
                }
                ]
            });
            //#endregion

            //#region  页面模块
            //页面属性FieldSet
            var PageAttributeForm = new Ext.form.FieldSet({
                xtype: 'fieldset',
                checkboxToggle: true,
                title: '属性',
                autoHeight: true,
                collapsed: true,
                buttons: [{
                    text: "保存",
                    handler: function () {
                        var formpanel = Ext.getCmp("pageAttributeForm");
                        if (formpanel.getForm().isValid()) {
                            formpanel.getForm().submit({
                                url: '/Api/Cms/CmsPageAttribute/Add',
                                method: "Post",
                                waitTitle: '请等待',
                                waitMsg: '正在提交中',
                                success: function (form, action) {
                                    Ext.Msg.alert('提示', action.result.message);
                                },
                                failure: function (form, action) {
                                    Ext.Msg.alert('提示', action.result.message);
                                }
                            });
                        }
                    }
                }],
                items: [
                    new Ext.form.FormPanel({
                        frame: true,
                        id: 'pageAttributeForm',
                        autoScroll: false,
                        baseCls: 'x-plain',
                        layout: 'form',
                        labelAlign: "right",
                        labelWidth: 65,
                        reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' },
                            [
                                'ID', 'isTop', 'isPic', 'isHot', 'isRecommend', 'isComment', 'SortIndex', 'ReadCount', 'CreateUserID', 'UpdateTime', 'UpdateUserID', 'PageTypeID'
                            ]),
                        items: [
                            {
                                layout: 'column',
                                items: [
                                    {
                                        columnWidth: .14,
                                        layout: 'form',
                                        items: [

                                            {
                                                xtype: 'combo',
                                                fieldLabel: '顶置',
                                                name: 'isTop',
                                                hiddenName: 'isTop',
                                                mode: 'local',
                                                displayField: "Name",
                                                valueField: "Id",
                                                editable: false,
                                                typeAhead: true,
                                                emptyText: '请选择...',
                                                forceSelection: true,
                                                triggerAction: 'all',
                                                anchor: "100%",
                                                store: new Ext.data.JsonStore({
                                                    autoLoad: true,
                                                    method: 'Post',
                                                    idProperty: 'ID',
                                                    url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                                    fields: [{
                                                        name: 'Name',
                                                        mapping: 'Title'
                                                    }, {
                                                        name: 'Id',
                                                        mapping: 'Value'
                                                    }]
                                                })
                                            }
                                        ]
                                    },
                                    {
                                        columnWidth: .14,
                                        layout: 'form',
                                        items: [{
                                            xtype: 'combo',
                                            fieldLabel: '幻灯片',
                                            name: 'isPic',
                                            hiddenName: 'isPic',
                                            mode: 'local',
                                            displayField: "Name",
                                            valueField: "Id",
                                            editable: false,
                                            typeAhead: true,
                                            emptyText: '请选择...',
                                            forceSelection: true,
                                            triggerAction: 'all',
                                            anchor: "100%",
                                            store: new Ext.data.JsonStore({
                                                autoLoad: true,
                                                method: 'Post',
                                                idProperty: 'ID',
                                                url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                                fields: [{
                                                    name: 'Name',
                                                    mapping: 'Title'
                                                }, {
                                                    name: 'Id',
                                                    mapping: 'Value'
                                                }]
                                            })
                                        }]
                                    },
                                    {
                                        columnWidth: .14,
                                        layout: 'form',
                                        items: [{
                                            xtype: 'combo',
                                            fieldLabel: '热门',
                                            name: 'isHot',
                                            hiddenName: 'isHot',
                                            mode: 'local',
                                            displayField: "Name",
                                            valueField: "Id",
                                            editable: false,
                                            typeAhead: true,
                                            emptyText: '请选择...',
                                            forceSelection: true,
                                            triggerAction: 'all',
                                            anchor: "100%",
                                            store: new Ext.data.JsonStore({
                                                autoLoad: true,
                                                method: 'Post',
                                                idProperty: 'ID',
                                                url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                                fields: [{
                                                    name: 'Name',
                                                    mapping: 'Title'
                                                }, {
                                                    name: 'Id',
                                                    mapping: 'Value'
                                                }]
                                            })
                                        }]
                                    },
                                    {
                                        columnWidth: .14,
                                        layout: 'form',
                                        items: [{
                                            xtype: 'combo',
                                            fieldLabel: '推荐',
                                            name: 'isRecommend',
                                            hiddenName: 'isRecommend',
                                            mode: 'local',
                                            displayField: "Name",
                                            valueField: "Id",
                                            editable: false,
                                            typeAhead: true,
                                            emptyText: '请选择...',
                                            forceSelection: true,
                                            triggerAction: 'all',
                                            anchor: "100%",
                                            store: new Ext.data.JsonStore({
                                                autoLoad: true,
                                                method: 'Post',
                                                idProperty: 'ID',
                                                url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                                fields: [{
                                                    name: 'Name',
                                                    mapping: 'Title'
                                                }, {
                                                    name: 'Id',
                                                    mapping: 'Value'
                                                }]
                                            })
                                        }]
                                    },
                                    {
                                        columnWidth: .14,
                                        layout: 'form',
                                        items: [{
                                            xtype: 'combo',
                                            fieldLabel: '评论',
                                            name: 'isComment',
                                            hiddenName: 'isComment',
                                            mode: 'local',
                                            displayField: "Name",
                                            valueField: "Id",
                                            editable: false,
                                            typeAhead: true,
                                            emptyText: '请选择...',
                                            forceSelection: true,
                                            triggerAction: 'all',
                                            anchor: "100%",
                                            store: new Ext.data.JsonStore({
                                                autoLoad: true,
                                                method: 'Post',
                                                idProperty: 'ID',
                                                url: "/Api/Dictionary/GetDictionaryByPCode?pcode=Status",
                                                fields: [{
                                                    name: 'Name',
                                                    mapping: 'Title'
                                                }, {
                                                    name: 'Id',
                                                    mapping: 'Value'
                                                }]
                                            })
                                        }]
                                    }, {
                                        columnWidth: .14,
                                        layout: 'form',
                                        items: [{ xtype: 'textfield', readOnly: false, fieldLabel: '排序', value: 0, name: 'SortIndex', anchor: "100%" }]
                                    }, {
                                        columnWidth: .14,
                                        layout: 'form',
                                        items: [{ xtype: 'textfield', readOnly: false, fieldLabel: '浏览次数', value: 0, name: 'ReadCount', anchor: "100%" }]
                                    }
                                ]
                            },
                        { xtype: 'hidden', name: 'ID' },
                        { xtype: 'hidden', name: 'CreateUserID', value: "@CurrentLogInfo.CurrentLog.ID" },
                        { xtype: 'hidden', name: 'UpdateTime', value: "@DateTime.Now.ToString("yyyy-MM-dd HH:mm:ss")" },
                        { xtype: 'hidden', name: 'UpdateUserID', value: "@CurrentLogInfo.CurrentLog.ID" },
                        { xtype: 'hidden', id: 'pageattributepid', name: 'PageID' }
                        ]
                    })]
            });
                //页面标题
                var PageTitleForm = new Ext.form.FieldSet({
                    xtype: 'fieldset',
                    checkboxToggle: true,
                    title: '标题',
                    autoHeight: true,
                    anchor:"100%",
                    collapsed: true,
                    buttons: [{text:"保存"}],
                    items: [
                      new Ext.form.FormPanel({
                          frame: true,
                          id: 'pageTitleForm',
                          autoScroll: true,
                          layout: 'form',
                          labelAlign: "right",
                          labelWidth: 65,
                          reader: new Ext.data.JsonReader({ successProperty: 'success', root: 'message' },
                          [
                                'ID', 'TitleContent', 'Remark', 'PageTypeID'
                          ]),
                          items: [
                              { xtype: 'hidden', name: 'ID' },
                               { xtype: 'Starthtmleditor', hideLabel: false, name: 'Remark', fieldLabel: '内容摘要', labelWidth: 65, anchor: "100%",height:200 },
                               { xtype: 'Starthtmleditor', hideLabel: false, name: 'TitleContent', fieldLabel: '标题内容', labelWidth: 65, anchor: "100%" ,height:800 },
                              //{ xtype: 'textfield', readOnly: false, fieldLabel: '内容摘要', name: 'Remark', labelWidth: 50 },
                              //{ xtype: 'textfield', readOnly: false, fieldLabel: '标题内容', name: 'TitleContent', labelWidth: 50 },
                              { xtype: 'hidden',id:"pagetitlepid",  name: 'PageID'}
                          ]
                      })
                    ]
                });

                //#endregion

                var contentPanel = new Ext.Panel({
                    title: '新增模板内容',
                    frame: true,
                    autoScroll: true,
                    id: "contentpanel",
                    items: [PageAttributeForm, PageTitleForm]
                });



                var pageTypePanel = new Ext.Panel({
                    title: '页面制作',
                    frame: true,
                    autoScroll: true,
                    anchor: "100% 100%",
                    hidden: true,
                    items: [pageTypefrom, contentPanel]
                });

                //控制pannel及form的显示
                function RefreshPanel(formpanel, panel) {
                    webSiteform.hide();
                    channelForm.hide();
                    classifyForm.hide();
                    pageTypefrom.hide();
                    formpanel.show();
                    panel.doLayout();
                    pageTypePanel.hide();
                }


                Ext.onReady(function () {
                    Ext.QuickTips.init();
                    new Ext.Viewport({
                        title: "Viewport",
                        layout: "border",
                        defaults: {
                            bodyStyle: "background-color: #FFFFFF;",
                        },
                        items: [
                                    {
                                        region: 'west',
                                        title: '网站信息',
                                        xtype: 'treepanel',
                                        id: "webSiteTree",
                                        width: 200,
                                        autoScroll: true,
                                        loader: new Ext.tree.TreeLoader({
                                            url: '/Api/Cms/CmsPageType/GetWebSiteTree'
                                        }),
                                        root: new Ext.tree.AsyncTreeNode({
                                            expanded: true,
                                        }),
                                        rootVisible: false,
                                        listeners: {
                                            click: function (node) {
                                                var pannel = Ext.getCmp("panel1");

                                                switch (node.attributes.attributes.type) {
                                                    case "WebSite":
                                                        webSiteform.form.load({
                                                            url: '@Url.Content("/Api/Cms/WebSite/GetForm/")' + node.id,
                                                            method: "Get",
                                                            waitMsg: 'Loading',
                                                            success: function (form, response) {
                                                                RefreshPanel(webSiteform, pannel)
                                                            }
                                                        });
                                                        break;
                                                    case "CmsChannel":
                                                        channelForm.form.load({
                                                            url: '@Url.Content("/Api/Cms/CmsChannel/GetForm/")' + node.id,
                                                        method: "Get",
                                                        waitMsg: 'Loading',
                                                        success: function (form, response) {
                                                            RefreshPanel(channelForm, pannel)
                                                        }
                                                    });
                                                    break;
                                                case "CmsClassify":
                                                    classifyForm.form.load({
                                                        url: '@Url.Content("/Api/Cms/CmsClassify/GetForm/")' + node.id,
                                                method: "Get",
                                                waitMsg: 'Loading',
                                                success: function (form, response) {
                                                    RefreshPanel(classifyForm, pannel)
                                                }
                                            });
                                            break;
                                        case "CmsPageType":
                                            pageTypefrom.form.load({
                                                url: '@Url.Content("/Api/Cms/CmsPageType/GetForm/")' + node.id,
                                                method: "Get",
                                                waitMsg: 'Loading',
                                                success: function (form, response) {
                                                    webSiteform.hide();
                                                    channelForm.hide();
                                                    classifyForm.hide();
                                                    pageTypefrom.show();
                                                    pageTypePanel.show();
                                                    channelForm.doLayout();
                                                    pageTypePanel.doLayout();
                                                    Ext.getCmp("pageattributepid").setValue(node.id);
                                                    Ext.getCmp("pagetitlepid").setValue(node.id);
                                                }
                                            });
                                            break;
                                    }

                                            }
                                        }
                                    },
                        {
                            region: "center",
                            id: "panel1",
                            split: true,
                            border: false,
                            collapsible: false,
                            xtype: "panel",
                            layout: "anchor",
                            items: [channelForm, webSiteform, classifyForm, pageTypePanel]

                        }

                        ]
                    });

                });

</script>
@* var pid;

    
    var addform = new Ext.FormPanel({
        buttonAlign: 'center',
        labelAlign: "right",
        plain: true,
        anchor: '100% 100%',
        layout: "anchor",
        frame: true,
        reader: new Ext.data.JsonReader(
            { successProperty: 'success', root: 'message' },
            ['ID', 'PDictionaryID', 'Code', 'Title', 'Value', 'Sort', 'iconCls', 'Desc']
         ),
        defaults: { margins: '0 5 0 0' },
        title: "字典信息",
        items: [
            {
                xtype: 'fieldset',
                collapsible: false,
                anchor: '100% 100%',
                items: [{
                    xtype: "hidden",
                    name: "PDictionaryID",
                    id: "pid"
                },
                {
                    xtype: "hidden",
                    name: "ID",
                    id:'id'
                }, {
                    xtype: "textfield",
                    name: "Code",
                    fieldLabel: '字典代码',
                },
                    {
                        fieldLabel: '字典键',
                        name: 'Title',
                        xtype: 'textfield',
                        width: 300
                    }, {
                        fieldLabel: '字典值',
                        name: 'Value',
                        xtype: 'textfield',
                        width: 300
                    }, {
                        fieldLabel: '字典排序',
                        name: 'Sort',
                        xtype: 'textfield',
                        width: 300
                    },
                    {
                        fieldLabel: '备注',
                        xtype: 'textarea',
                        name: "Desc",
                        height: 150,
                        anchor: '95%'
                    }
                ]
            }
        ], buttons: [{
            xtype: "button",
            text: "新增子项",
            id: 'subadd',
            style: "float:right",
            handler: function () {
                addform.form.reset();
            }
        }, {
            xtype: "button",
            text: "保存",
            id:"update",
            style: "float:right",
            handler: function () {
                var pid = Ext.getCmp("id").getValue();
                var type = pid ? "Put" : "Post";
                addform.getForm().submit({
                    url: '/Api/Dictionary/' + pid,
                    method: type,
                    waitTitle: '请等待',
                    waitMsg: '正在提交中',
                    success: function (form, action) {
                        Ext.getCmp("dictree").root.reload()
                        Ext.Msg.alert('提示', action.result.message);
                    },
                    failure: function (form, action) {
                        Ext.Msg.alert('提示', action.result.message);
                    }
                });
            }
        }, {
            xtype: "button",
            text: "返回",
            id: "return",
            hidden: true,
            style: "float:right",
            handler: function () {
                addform.form.reset()
                Ext.getCmp("update").show();
                Ext.getCmp("subadd").show();
                Ext.getCmp("return").hide();
                Ext.getCmp("reset").hide();
                addform.form.load({
                    url: '@Url.Content("/Api//Dictionary/GetForm/")' + pid,
                    method: "Get",
                    waitMsg: 'Loading',
                    success: function (form, action) {
                      //  ;
                    }
                });
            }
        }, {
            xtype: "button",
            text: "删除",
            id: "delete",
            style: "float:right",
            handler: function () {
                addform.form.submit({
                    url: '@Url.Content("/Api/Dictionary/")' + Ext.getCmp("id").getValue(),
                     method: "Delete",
                     waitMsg: 'Loading',
                     success: function (form, action) {
                         Ext.getCmp("dictree").root.reload()
                         addform.form.reset();
                         Ext.Msg.alert('提示', action.result.message);
                     }
                });
            }
        }, {
            xtype: "button",
            text: "重置",
            id: "reset",
            hidden: true,
            style: "float:right",
            handler: function () {
                addform.form.reset();
                Ext.getCmp("pid").setValue(pid);
            }
        }]
    });*@